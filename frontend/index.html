<!DOCTYPE html>
<html lang="en">

<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover" />
  <link rel="icon" href="./img/logo.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="./img/pwa/logo-192.png">
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <link rel="mask-icon" href="./img/logo.svg" color="#FFFFFF">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="theme-color" content="#ffffff">
  <meta name="referrer" content="origin-when-cross-origin" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>BingAI - 聊天</title>
<!--  <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>-->
<!--    <script>-->
<!--        var vConsole = new window.VConsole();-->
<!--    </script>-->
    <!-- Google tag (gtag.js) -->
    <!--  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MM5J5X8QQC"></script>-->
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-MM5J5X8QQC');
    </script>
    <!-- 百度统计 -->
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?c1e185ac723e429447092c743bca5eed";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <script src="/js/bing/chat/global.js"></script>
    <script src="/js/bing/chat/amd.js"></script>
    <script src="/js/bing/chat/config.js"></script>
</head>

<body>
  <div id="b_sydHeadBg"></div>
  <div id="b_sydConvCont" _iid="SERP.5029">
    <div id="b_sydtoporpole" class="b_sydConvAnsTest"></div>
    <div id="b_sydBgCover"></div>
  </div>
  <script src="/js/bing/chat/core.js"></script>
  <script src="/js/bing/chat/lib.js"></script>
  <div id="app">
    <style>
      /* loading start */
      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        opacity: 1;
        transition: opacity 2s ease-out;
      }

      .loading-spinner.hidden {
        opacity: 0;
      }

      .loading-spinner>div {
        width: 30px;
        height: 30px;
        background: linear-gradient(90deg, #2870EA 10.79%, #1B4AEF 87.08%);

        border-radius: 100%;
        display: inline-block;
        -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;
        animation: sk-bouncedelay 1.4s infinite ease-in-out both;
      }

      .loading-spinner .bounce1 {
        -webkit-animation-delay: -0.32s;
        animation-delay: -0.32s;
      }

      .loading-spinner .bounce2 {
        -webkit-animation-delay: -0.16s;
        animation-delay: -0.16s;
      }

      @-webkit-keyframes sk-bouncedelay {

        0%,
        80%,
        100% {
          -webkit-transform: scale(0)
        }

        40% {
          -webkit-transform: scale(1.0)
        }
      }

      @keyframes sk-bouncedelay {

        0%,
        80%,
        100% {
          -webkit-transform: scale(0);
          transform: scale(0);
        }

        40% {
          -webkit-transform: scale(1.0);
          transform: scale(1.0);
        }
      }

      /* loading end */
    </style>
      <!-- loading start -->
      <div class="loading-spinner">
          <div class="bounce1"></div>
          <div class="bounce2"></div>
          <div class="bounce3"></div>
      </div>
      <!-- loading end -->
  </div>
  <script type="module" src="/src/main.ts"></script>
  <script>
      window.cefRecord = {}
      window.config = {
          "disableSydGhosting": true,
          "overrideSydOptions": true,
          // "language": "Chinese (China)",
          "enableOneClickCopy": true,
          "enableSkipContentOriginCheck": true,
          "enableStandaloneUtility": true,
          "enablePreserveTextFormat": true,
          "enableSydBeacon": true,
          "enableShareOnHostMessage": false,
          "enableChatCoach": true,
          "enableAutoRecoverFromInvalidSession": true,
          "enableAutoRecoverFromInvalidSessionForFirstTurn": true,
          "enableCodexMuidConsentUx": true,
          "enableFixCodeXAsBug": false,
          "enableCreatorSendQueryWhenShowConvQuery": true,
          "enableCodexWinBotMessage": true,
          "enableCodexWin": true,
          "enableThreads": true,
          "codexWinEnableCustomGreeting": true,
          "codexWinGreetingCustomString": "{}",
          "enableCodeCopy": true,
          "enableMaxTurnsPerConversation": true,  // 是否启用每次对话的最大轮数
          "maxTurnsPerConversation": 72,  // 每次对话的最大轮数
          "maxTurnsPerConversationMuidUser": 72,
          "userPriorityLevel": 1,  // 用户优先级级别
          "enableUserPriorityLevel": true,  // 是否启用用户优先级级别
          "syntheticStreamSpeed": 10,  // 合成流速度
      }
      if (window._sydConvConfig) {
          Object.assign(window._sydConvConfig, window.config)
      }
      console.log(window._sydConvConfig)
      window.addEventListener('load', function () {
          setTimeout(() => {
              let interval = setInterval(() => {
                  if (window.CIB) {
                      CIB.vm.factory.messages.conversation.addMessage(CIB.manager.modelFactory.createLocalMeta({
                          text: "用户优先级已调整",
                          author: "bot"
                      }))
                      CIB.vm.factory.messages.conversation.addMessage(CIB.manager.modelFactory.createLocalMeta({
                          text: "合成流速度已调整",
                          author: "bot"
                      }))
                      CIB.vm.factory.messages.conversation.addMessage(CIB.manager.modelFactory.createLocalMeta({
                          text: "网页版地址 https://bing.xr21.me",
                          author: "bot"
                      }))
                      CIB.vm.factory.messages.conversation.addMessage(CIB.manager.modelFactory.createLocalMeta({
                          text: "问题反馈请移步至社区 https://forum.xr21.me",
                          author: "bot"
                      }))
                      CIB.vm.factory.messages.conversation.addMessage(CIB.manager.modelFactory.createLocalMeta({
                          text: "新插件X-ChatGPT欢迎使用",
                          author: "bot"
                      }))
                      Object.assign(window._sydConvConfig, window.config)
                      clearInterval(interval)
                  }
              }, 500)
          }, 2000)
      })
      window.XAction = function (query) {
          console.log("XAction", query)
          if (window.CIB) {
              window.CIB.setActionBarInputText(query)
              window.CIB.submitInputText()
          }
          // if (window.cefQuery) {
          // window.observerConfig = {
          //     attributes: true,
          //     childList: true,
          //     subtree: true
          // };
          // console.log(window.observerConfig)
          // window.observerCallback = function (mutationsList, observer) {
          //     for (let mutation of mutationsList) {
          //         if (mutation.type === 'childList') {
          //             const addedNodes = mutation.addedNodes;
          //             for (let i = 0; i < addedNodes.length; i++) {
          //                 if (addedNodes[i].nodeName === "CIB-CHAT-TURN") {
          //                     window.messageTimer = setInterval(() => {
          //                         let lastMessage = addedNodes[1]._vm.factory.messages.conversation.lastMessage;
          //                         if (lastMessage == null) {
          //                             return;
          //                         }
          //                         if (window.cefRecord[lastMessage.messageId]) {
          //                             clearInterval(window.messageTimer);
          //                         }
          //                         // console.log('lastMessage', lastMessage.text)
          //                         if (lastMessage._isFinalized && !window.cefRecord[lastMessage.messageId]) {
          //                             window.cefRecord[lastMessage.messageId] = true;
          //                             window.cefQuery({
          //                                 request: JSON.stringify({ event: "replace", message: lastMessage.text }),
          //                                 onSuccess: function (response) {
          //                                     console.log(response)
          //                                     clearInterval(window.messageTimer);
          //                                 },
          //                                 onFailure: function (error_code, error_message) {
          //                                     console.log(error_message)
          //                                 }
          //                             });
          //                         }
          //                     }, 500)
          //                 }
          //             }
          //         }
          //     }
          // }
          // 创建一个观察器实例并传入回调函数
          // window.observer = new MutationObserver(window.observerCallback);
          // console.log(window.observer)
          // window.targetNode = document.querySelector('cib-serp').shadowRoot.querySelector('cib-conversation').shadowRoot;
          // console.log(window.targetNode)
          // window.targetNode = document.querySelector('cib-serp');
          // 用配置文件对目标节点进行观察
          // window.observer.observe(window.targetNode, window.observerConfig)

          // } else {
          //     console.log("cefQuery not available");
          // }
      };

  </script>
</body>

</html>